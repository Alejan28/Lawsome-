{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\40741\\\\IdeaProjects\\\\lawsome-app\\\\src\\\\components\\\\chat\\\\ChatUI.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { ChatFlow } from \"./ChatFlow\";\nimport { DOCUMENT_TYPES } from \"./models/documentTypes\";\nimport { downloadDocx } from \"./fileUtils\";\nimport { useAuth } from \"../../auth/AuthContext\";\nimport { useChatHistory } from \"../../hooks/useChatHistory\";\nimport ChatHistorySidebar from \"./ChatHistorySidebar\";\n\n// Create ONE flow instance (acts like a controller)\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst chatFlow = new ChatFlow(DOCUMENT_TYPES);\nconst ChatUI = ({\n  messageService\n}) => {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const {\n    conversations,\n    messages: historyMessages,\n    loading: historyLoading,\n    saveMessage,\n    startNewConversation,\n    selectConversation,\n    deleteConversation\n  } = useChatHistory(user === null || user === void 0 ? void 0 : user.uid);\n  const [mode, setMode] = useState(\"generation\"); // generation | analysis | qa\n\n  const [localMessages, setLocalMessages] = useState([{\n    sender: \"bot\",\n    text: \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\"\n  }]);\n  const [input, setInput] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [isHistoryOpen, setIsHistoryOpen] = useState(false);\n  const messagesEndRef = useRef(null);\n  const fileInputRef = useRef(null);\n\n  // If historyMessages are loaded (meaning a conversation is selected), use them.\n  // Otherwise, use localMessages (for new/unauthenticated sessions).\n  const messages = user && historyMessages.length > 0 ? historyMessages : localMessages;\n  useEffect(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages, isLoading]);\n\n  // When a conversation is selected, we might want to switch mode if we stored it.\n  const handleSelectConversation = id => {\n    selectConversation(id);\n    const conv = conversations.find(c => c.id === id);\n    if (conv && conv.mode) {\n      setMode(conv.mode);\n    }\n    setIsHistoryOpen(false);\n  };\n  const handleNewConversation = () => {\n    // When starting new, we keep the CURRENT mode selected by the user\n    startNewConversation(\"Conversa»õie NouƒÉ\", mode);\n    let initialText = \"\";\n    if (mode === \"generation\") initialText = \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\";else if (mode === \"analysis\") initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";else if (mode === \"qa\") initialText = \"üëã Salut! Cu ce problemƒÉ legalƒÉ te pot ajuta?\";\n    setLocalMessages([{\n      sender: \"bot\",\n      text: initialText\n    }]);\n    if (mode === \"generation\") chatFlow.reset();\n    setIsHistoryOpen(false);\n  };\n\n  // Switch mode handler (resets current view if it's a new session)\n  const handleModeChange = newMode => {\n    setMode(newMode);\n    let initialText = \"\";\n    if (newMode === \"generation\") initialText = \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\";else if (newMode === \"analysis\") initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";else if (newMode === \"qa\") initialText = \"üëã Salut! Cu ce problemƒÉ legalƒÉ te pot ajuta?\";\n    setLocalMessages([{\n      sender: \"bot\",\n      text: initialText\n    }]);\n    if (user) {\n      selectConversation(null);\n    }\n    if (newMode === \"generation\") chatFlow.reset();\n  };\n  const addMsg = async msg => {\n    setLocalMessages(prev => [...prev, msg]);\n    if (user) {\n      await saveMessage(msg, mode);\n    }\n  };\n  const handleFileUpload = async e => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    // Ensure greeting is saved if this is a new conversation\n    if (user && historyMessages.length === 0) {\n      let initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";\n      await saveMessage({\n        sender: \"bot\",\n        text: initialText\n      }, mode);\n    }\n    await addMsg({\n      sender: \"user\",\n      text: `üìé Am √ÆncƒÉrcat: ${file.name}`\n    });\n    setIsLoading(true);\n    try {\n      const response = await messageService.analyzeDocument(file);\n      const resultText = response.explanation || response.result || JSON.stringify(response);\n      await addMsg({\n        sender: \"bot\",\n        text: `‚úÖ AnalizƒÉ completƒÉ:\\n\\n${resultText}`\n      });\n    } catch (error) {\n      console.error(error);\n      await addMsg({\n        sender: \"bot\",\n        text: \"‚ùå Eroare la analizarea documentului.\"\n      });\n    } finally {\n      setIsLoading(false);\n      if (fileInputRef.current) fileInputRef.current.value = \"\";\n    }\n  };\n  const sendMessage = async () => {\n    if (!input.trim() || isLoading) return;\n    const userInput = input.trim();\n    setInput(\"\");\n\n    // Ensure greeting is saved if this is a new conversation\n    if (user && historyMessages.length === 0) {\n      let initialText = \"\";\n      if (mode === \"generation\") initialText = \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\";else if (mode === \"analysis\") initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";else if (mode === \"qa\") initialText = \"üëã Salut! Cu ce problemƒÉ legalƒÉ te pot ajuta?\";\n      await saveMessage({\n        sender: \"bot\",\n        text: initialText\n      }, mode);\n    }\n    await addMsg({\n      sender: \"user\",\n      text: userInput\n    });\n    try {\n      if (mode === \"generation\") {\n        // --- GENERATION LOGIC ---\n        if (!chatFlow.isDocumentSelected()) {\n          const question = chatFlow.selectDocument(userInput.toLowerCase());\n          await addMsg({\n            sender: \"bot\",\n            text: question\n          });\n          return;\n        }\n        const result = chatFlow.handleAnswer(userInput);\n        if (!result.done) {\n          await addMsg({\n            sender: \"bot\",\n            text: result.nextQuestion\n          });\n          return;\n        }\n        setIsLoading(true);\n        const blob = await messageService.sendMessage(result.payload);\n        await addMsg({\n          sender: \"bot\",\n          text: \"üìÑ Documentul este gata!\",\n          fileBlob: blob\n        });\n        await addMsg({\n          sender: \"bot\",\n          text: \"Vrei sƒÉ generezi un alt document?\"\n        });\n        chatFlow.reset();\n        setIsLoading(false);\n      } else if (mode === \"qa\") {\n        // --- Q&A LOGIC ---\n        setIsLoading(true);\n        const response = await messageService.askQuestion(userInput);\n        const answerText = response.answer || response.result || JSON.stringify(response);\n        await addMsg({\n          sender: \"bot\",\n          text: answerText\n        });\n        setIsLoading(false);\n      } else if (mode === \"analysis\") {\n        // --- ANALYSIS LOGIC ---\n        setIsLoading(true);\n        try {\n          const data = await messageService.askQuestion(userInput);\n\n          // Check for 'response' key here as well\n          const answerText = data.response || data.answer || JSON.stringify(data);\n          await addMsg({\n            sender: \"bot\",\n            text: answerText\n          });\n        } catch (error) {\n          await addMsg({\n            sender: \"bot\",\n            text: \"Eroare la comunicarea cu serverul.\"\n          });\n        }\n        setIsLoading(false);\n      }\n    } catch (err) {\n      console.error(err);\n      await addMsg({\n        sender: \"bot\",\n        text: \"‚ùå A apƒÉrut o eroare. Te rog √ÆncearcƒÉ din nou.\"\n      });\n      chatFlow.reset();\n      setIsLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: styles.wrapper,\n    children: [/*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n                .history-btn {\n                    background: transparent;\n                    border: none;\n                    cursor: pointer;\n                    color: #6B7280;\n                    font-size: 14px;\n                    font-weight: 500;\n                    display: flex;\n                    align-items: center;\n                    gap: 8px;\n                    padding: 8px 12px;\n                    border-radius: 8px;\n                    transition: all 0.2s ease;\n                }\n                .history-btn:hover {\n                    background-color: #F3F4F6;\n                    color: #4F46E5;\n                }\n                .history-btn.active {\n                    color: #4F46E5;\n                    background-color: #EEF2FF;\n                }\n                .mode-tab {\n                    padding: 8px 16px;\n                    border-radius: 20px;\n                    border: none;\n                    cursor: pointer;\n                    font-size: 13px;\n                    font-weight: 600;\n                    transition: all 0.2s;\n                    background: #f3f4f6;\n                    color: #6b7280;\n                }\n                .mode-tab.active {\n                    background: #4F46E5;\n                    color: white;\n                }\n            `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: styles.chatContainer,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: styles.header,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `mode-tab ${mode === 'generation' ? 'active' : ''}`,\n            onClick: () => handleModeChange('generation'),\n            children: \"Generare\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `mode-tab ${mode === 'analysis' ? 'active' : ''}`,\n            onClick: () => handleModeChange('analysis'),\n            children: \"Analiz\\u0103\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: `mode-tab ${mode === 'qa' ? 'active' : ''}`,\n            onClick: () => handleModeChange('qa'),\n            children: \"Q&A\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 21\n        }, this), user && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setIsHistoryOpen(!isHistoryOpen),\n          className: `history-btn ${isHistoryOpen ? 'active' : ''}`,\n          children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n            xmlns: \"http://www.w3.org/2000/svg\",\n            fill: \"none\",\n            viewBox: \"0 0 24 24\",\n            stroke: \"currentColor\",\n            className: \"history-icon\",\n            style: {\n              width: 18,\n              height: 18\n            },\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: 2,\n              d: \"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"Istoric\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 271,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: styles.messages,\n        children: [messages.map((msg, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: \"flex\",\n            justifyContent: msg.sender === \"user\" ? \"flex-end\" : \"flex-start\",\n            marginBottom: 10\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              ...styles.bubble,\n              background: msg.sender === \"user\" ? \"#6c63ff\" : \"#f2f2f2\",\n              color: msg.sender === \"user\" ? \"#fff\" : \"#000\"\n            },\n            children: [msg.text, (msg.fileBlob || msg.fileUrl) && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 10\n              },\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                style: styles.downloadBtn,\n                onClick: () => {\n                  if (msg.fileBlob) {\n                    downloadDocx(msg.fileBlob, \"document.docx\");\n                  } else if (msg.fileUrl) {\n                    window.open(msg.fileUrl, \"_blank\");\n                  }\n                },\n                children: \"\\u2B07\\uFE0F Descarc\\u0103 documentul\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 299,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 287,\n            columnNumber: 29\n          }, this)\n        }, i, false, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 25\n        }, this)), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.typing,\n          children: \"Bot scrie...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          ref: messagesEndRef\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: styles.inputBar,\n        children: [mode === 'analysis' && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"file\",\n            ref: fileInputRef,\n            style: {\n              display: 'none'\n            },\n            accept: \".pdf\",\n            onChange: handleFileUpload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 328,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              var _fileInputRef$current;\n              return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n            },\n            style: styles.attachBtn,\n            title: \"\\xCEncarc\\u0103 PDF\",\n            children: \"\\uD83D\\uDCCE\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: input,\n          onChange: e => setInput(e.target.value),\n          onKeyDown: e => e.key === \"Enter\" && sendMessage(),\n          placeholder: mode === 'analysis' ? \"√éncarcƒÉ un fi»ôier...\" : \"Scrie mesajul...\",\n          style: styles.input,\n          disabled: isLoading\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: sendMessage,\n          style: styles.sendBtn,\n          disabled: isLoading,\n          children: \"Trimite\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 353,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ChatHistorySidebar, {\n      isOpen: isHistoryOpen,\n      onClose: () => setIsHistoryOpen(false),\n      conversations: conversations,\n      onSelectConversation: handleSelectConversation,\n      onNewConversation: handleNewConversation,\n      onDeleteConversation: deleteConversation,\n      loading: historyLoading\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 197,\n    columnNumber: 9\n  }, this);\n};\n_s(ChatUI, \"NAW087b1w5CFU5BgJNyYwhH5pqU=\", false, function () {\n  return [useAuth, useChatHistory];\n});\n_c = ChatUI;\nexport default ChatUI;\nconst styles = {\n  wrapper: {\n    height: \"100%\",\n    display: \"flex\",\n    position: \"relative\",\n    overflow: \"hidden\"\n  },\n  chatContainer: {\n    flex: 1,\n    height: \"100%\",\n    display: \"flex\",\n    flexDirection: \"column\",\n    background: \"#fff\",\n    position: \"relative\"\n  },\n  header: {\n    padding: \"12px 24px\",\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    alignItems: \"center\",\n    background: \"#fff\"\n  },\n  messages: {\n    flex: 1,\n    padding: 20,\n    overflowY: \"auto\"\n  },\n  bubble: {\n    maxWidth: \"70%\",\n    padding: 14,\n    borderRadius: 16,\n    whiteSpace: \"pre-wrap\"\n  },\n  typing: {\n    fontSize: 12,\n    color: \"#999\",\n    marginTop: 6\n  },\n  inputBar: {\n    display: \"flex\",\n    gap: 10,\n    padding: 14,\n    borderTop: \"1px solid #eee\",\n    background: \"#fff\"\n  },\n  input: {\n    flex: 1,\n    padding: 12,\n    borderRadius: 10,\n    border: \"1px solid #ddd\",\n    outline: \"none\"\n  },\n  sendBtn: {\n    padding: \"0 20px\",\n    borderRadius: 10,\n    border: \"none\",\n    background: \"#6c63ff\",\n    color: \"#fff\",\n    cursor: \"pointer\"\n  },\n  attachBtn: {\n    padding: \"0 14px\",\n    borderRadius: 10,\n    border: \"1px solid #ddd\",\n    background: \"#f9fafb\",\n    cursor: \"pointer\",\n    fontSize: \"18px\"\n  },\n  downloadBtn: {\n    marginTop: 4,\n    padding: \"6px 10px\",\n    borderRadius: 6,\n    border: \"none\",\n    cursor: \"pointer\"\n  }\n};\nvar _c;\n$RefreshReg$(_c, \"ChatUI\");","map":{"version":3,"names":["React","useEffect","useRef","useState","ChatFlow","DOCUMENT_TYPES","downloadDocx","useAuth","useChatHistory","ChatHistorySidebar","jsxDEV","_jsxDEV","Fragment","_Fragment","chatFlow","ChatUI","messageService","_s","user","conversations","messages","historyMessages","loading","historyLoading","saveMessage","startNewConversation","selectConversation","deleteConversation","uid","mode","setMode","localMessages","setLocalMessages","sender","text","input","setInput","isLoading","setIsLoading","isHistoryOpen","setIsHistoryOpen","messagesEndRef","fileInputRef","length","_messagesEndRef$curre","current","scrollIntoView","behavior","handleSelectConversation","id","conv","find","c","handleNewConversation","initialText","reset","handleModeChange","newMode","addMsg","msg","prev","handleFileUpload","e","file","target","files","name","response","analyzeDocument","resultText","explanation","result","JSON","stringify","error","console","value","sendMessage","trim","userInput","isDocumentSelected","question","selectDocument","toLowerCase","handleAnswer","done","nextQuestion","blob","payload","fileBlob","askQuestion","answerText","answer","data","err","style","styles","wrapper","children","fileName","_jsxFileName","lineNumber","columnNumber","chatContainer","header","display","gap","className","onClick","xmlns","fill","viewBox","stroke","width","height","strokeLinecap","strokeLinejoin","strokeWidth","d","map","i","justifyContent","marginBottom","bubble","background","color","fileUrl","marginTop","downloadBtn","window","open","typing","ref","inputBar","type","accept","onChange","_fileInputRef$current","click","attachBtn","title","onKeyDown","key","placeholder","disabled","sendBtn","isOpen","onClose","onSelectConversation","onNewConversation","onDeleteConversation","_c","position","overflow","flex","flexDirection","padding","alignItems","overflowY","maxWidth","borderRadius","whiteSpace","fontSize","borderTop","border","outline","cursor","$RefreshReg$"],"sources":["C:/Users/40741/IdeaProjects/lawsome-app/src/components/chat/ChatUI.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { ChatFlow } from \"./ChatFlow\";\r\nimport { DOCUMENT_TYPES } from \"./models/documentTypes\";\r\nimport { downloadDocx } from \"./fileUtils\";\r\nimport { useAuth } from \"../../auth/AuthContext\";\r\nimport { useChatHistory } from \"../../hooks/useChatHistory\";\r\nimport ChatHistorySidebar from \"./ChatHistorySidebar\";\r\n\r\n// Create ONE flow instance (acts like a controller)\r\nconst chatFlow = new ChatFlow(DOCUMENT_TYPES);\r\n\r\nconst ChatUI = ({ messageService }) => {\r\n    const { user } = useAuth();\r\n    const { \r\n        conversations, \r\n        messages: historyMessages, \r\n        loading: historyLoading, \r\n        saveMessage, \r\n        startNewConversation, \r\n        selectConversation,\r\n        deleteConversation\r\n    } = useChatHistory(user?.uid);\r\n\r\n    const [mode, setMode] = useState(\"generation\"); // generation | analysis | qa\r\n    \r\n    const [localMessages, setLocalMessages] = useState([\r\n        {\r\n            sender: \"bot\",\r\n            text: \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\"\r\n        }\r\n    ]);\r\n\r\n    const [input, setInput] = useState(\"\");\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [isHistoryOpen, setIsHistoryOpen] = useState(false);\r\n\r\n    const messagesEndRef = useRef(null);\r\n    const fileInputRef = useRef(null);\r\n\r\n    // If historyMessages are loaded (meaning a conversation is selected), use them.\r\n    // Otherwise, use localMessages (for new/unauthenticated sessions).\r\n    const messages = (user && historyMessages.length > 0) ? historyMessages : localMessages;\r\n\r\n    useEffect(() => {\r\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, [messages, isLoading]);\r\n\r\n    // When a conversation is selected, we might want to switch mode if we stored it.\r\n    const handleSelectConversation = (id) => {\r\n        selectConversation(id);\r\n        const conv = conversations.find(c => c.id === id);\r\n        if (conv && conv.mode) {\r\n            setMode(conv.mode);\r\n        }\r\n        setIsHistoryOpen(false);\r\n    };\r\n\r\n    const handleNewConversation = () => {\r\n        // When starting new, we keep the CURRENT mode selected by the user\r\n        startNewConversation(\"Conversa»õie NouƒÉ\", mode);\r\n        \r\n        let initialText = \"\";\r\n        if (mode === \"generation\") initialText = \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\";\r\n        else if (mode === \"analysis\") initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";\r\n        else if (mode === \"qa\") initialText = \"üëã Salut! Cu ce problemƒÉ legalƒÉ te pot ajuta?\";\r\n\r\n        setLocalMessages([{\r\n            sender: \"bot\",\r\n            text: initialText\r\n        }]);\r\n        \r\n        if (mode === \"generation\") chatFlow.reset();\r\n        setIsHistoryOpen(false);\r\n    };\r\n\r\n    // Switch mode handler (resets current view if it's a new session)\r\n    const handleModeChange = (newMode) => {\r\n        setMode(newMode);\r\n        \r\n        let initialText = \"\";\r\n        if (newMode === \"generation\") initialText = \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\";\r\n        else if (newMode === \"analysis\") initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";\r\n        else if (newMode === \"qa\") initialText = \"üëã Salut! Cu ce problemƒÉ legalƒÉ te pot ajuta?\";\r\n\r\n        setLocalMessages([{ sender: \"bot\", text: initialText }]);\r\n        \r\n        if (user) {\r\n            selectConversation(null); \r\n        }\r\n        \r\n        if (newMode === \"generation\") chatFlow.reset();\r\n    };\r\n\r\n    const addMsg = async (msg) => {\r\n        setLocalMessages(prev => [...prev, msg]);\r\n        if (user) {\r\n            await saveMessage(msg, mode);\r\n        }\r\n    };\r\n\r\n    const handleFileUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (!file) return;\r\n\r\n        // Ensure greeting is saved if this is a new conversation\r\n        if (user && historyMessages.length === 0) {\r\n            let initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";\r\n            await saveMessage({ sender: \"bot\", text: initialText }, mode);\r\n        }\r\n\r\n        await addMsg({ sender: \"user\", text: `üìé Am √ÆncƒÉrcat: ${file.name}` });\r\n        setIsLoading(true);\r\n\r\n        try {\r\n            const response = await messageService.analyzeDocument(file);\r\n            const resultText = response.explanation || response.result || JSON.stringify(response);\r\n            await addMsg({ sender: \"bot\", text: `‚úÖ AnalizƒÉ completƒÉ:\\n\\n${resultText}` });\r\n        } catch (error) {\r\n            console.error(error);\r\n            await addMsg({ sender: \"bot\", text: \"‚ùå Eroare la analizarea documentului.\" });\r\n        } finally {\r\n            setIsLoading(false);\r\n            if (fileInputRef.current) fileInputRef.current.value = \"\";\r\n        }\r\n    };\r\n\r\n    const sendMessage = async () => {\r\n        if (!input.trim() || isLoading) return;\r\n\r\n        const userInput = input.trim();\r\n        setInput(\"\");\r\n\r\n        // Ensure greeting is saved if this is a new conversation\r\n        if (user && historyMessages.length === 0) {\r\n            let initialText = \"\";\r\n            if (mode === \"generation\") initialText = \"üëã Salut! Ce tip de document dore»ôti sƒÉ generezi?\\n(cerere / contract / procura)\";\r\n            else if (mode === \"analysis\") initialText = \"üëã Salut! √éncarcƒÉ un document PDF pentru analizƒÉ.\";\r\n            else if (mode === \"qa\") initialText = \"üëã Salut! Cu ce problemƒÉ legalƒÉ te pot ajuta?\";\r\n            \r\n            await saveMessage({ sender: \"bot\", text: initialText }, mode);\r\n        }\r\n\r\n        await addMsg({ sender: \"user\", text: userInput });\r\n\r\n        try {\r\n            if (mode === \"generation\") {\r\n                // --- GENERATION LOGIC ---\r\n                if (!chatFlow.isDocumentSelected()) {\r\n                    const question = chatFlow.selectDocument(userInput.toLowerCase());\r\n                    await addMsg({ sender: \"bot\", text: question });\r\n                    return;\r\n                }\r\n                const result = chatFlow.handleAnswer(userInput);\r\n                if (!result.done) {\r\n                    await addMsg({ sender: \"bot\", text: result.nextQuestion });\r\n                    return;\r\n                }\r\n                setIsLoading(true);\r\n                const blob = await messageService.sendMessage(result.payload);\r\n                await addMsg({ sender: \"bot\", text: \"üìÑ Documentul este gata!\", fileBlob: blob });\r\n                await addMsg({ sender: \"bot\", text: \"Vrei sƒÉ generezi un alt document?\" });\r\n                chatFlow.reset();\r\n                setIsLoading(false);\r\n\r\n            } else if (mode === \"qa\") {\r\n                // --- Q&A LOGIC ---\r\n                setIsLoading(true);\r\n                const response = await messageService.askQuestion(userInput);\r\n                const answerText = response.answer || response.result || JSON.stringify(response);\r\n                await addMsg({ sender: \"bot\", text: answerText });\r\n                setIsLoading(false);\r\n\r\n            } else if (mode === \"analysis\") {\r\n                // --- ANALYSIS LOGIC ---\r\n                setIsLoading(true);\r\n                try {\r\n                    const data = await messageService.askQuestion(userInput);\r\n\r\n                    // Check for 'response' key here as well\r\n                    const answerText = data.response || data.answer || JSON.stringify(data);\r\n\r\n                    await addMsg({ sender: \"bot\", text: answerText });\r\n                } catch (error) {\r\n                    await addMsg({ sender: \"bot\", text: \"Eroare la comunicarea cu serverul.\" });\r\n                }\r\n                setIsLoading(false);            }\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            await addMsg({ sender: \"bot\", text: \"‚ùå A apƒÉrut o eroare. Te rog √ÆncearcƒÉ din nou.\" });\r\n            chatFlow.reset();\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={styles.wrapper}>\r\n            <style>{`\r\n                .history-btn {\r\n                    background: transparent;\r\n                    border: none;\r\n                    cursor: pointer;\r\n                    color: #6B7280;\r\n                    font-size: 14px;\r\n                    font-weight: 500;\r\n                    display: flex;\r\n                    align-items: center;\r\n                    gap: 8px;\r\n                    padding: 8px 12px;\r\n                    border-radius: 8px;\r\n                    transition: all 0.2s ease;\r\n                }\r\n                .history-btn:hover {\r\n                    background-color: #F3F4F6;\r\n                    color: #4F46E5;\r\n                }\r\n                .history-btn.active {\r\n                    color: #4F46E5;\r\n                    background-color: #EEF2FF;\r\n                }\r\n                .mode-tab {\r\n                    padding: 8px 16px;\r\n                    border-radius: 20px;\r\n                    border: none;\r\n                    cursor: pointer;\r\n                    font-size: 13px;\r\n                    font-weight: 600;\r\n                    transition: all 0.2s;\r\n                    background: #f3f4f6;\r\n                    color: #6b7280;\r\n                }\r\n                .mode-tab.active {\r\n                    background: #4F46E5;\r\n                    color: white;\r\n                }\r\n            `}</style>\r\n\r\n            <div style={styles.chatContainer}>\r\n                {/* Header */}\r\n                <div style={styles.header}>\r\n                    {/* Mode Selector */}\r\n                    <div style={{ display: 'flex', gap: 8 }}>\r\n                        <button \r\n                            className={`mode-tab ${mode === 'generation' ? 'active' : ''}`}\r\n                            onClick={() => handleModeChange('generation')}\r\n                        >\r\n                            Generare\r\n                        </button>\r\n                        <button \r\n                            className={`mode-tab ${mode === 'analysis' ? 'active' : ''}`}\r\n                            onClick={() => handleModeChange('analysis')}\r\n                        >\r\n                            AnalizƒÉ\r\n                        </button>\r\n                        <button \r\n                            className={`mode-tab ${mode === 'qa' ? 'active' : ''}`}\r\n                            onClick={() => handleModeChange('qa')}\r\n                        >\r\n                            Q&A\r\n                        </button>\r\n                    </div>\r\n\r\n                    {user && (\r\n                        <button \r\n                            onClick={() => setIsHistoryOpen(!isHistoryOpen)}\r\n                            className={`history-btn ${isHistoryOpen ? 'active' : ''}`}\r\n                        >\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" className=\"history-icon\" style={{width: 18, height: 18}}>\r\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                            </svg>\r\n                            <span>Istoric</span>\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                <div style={styles.messages}>\r\n                    {messages.map((msg, i) => (\r\n                        <div\r\n                            key={i}\r\n                            style={{\r\n                                display: \"flex\",\r\n                                justifyContent:\r\n                                    msg.sender === \"user\" ? \"flex-end\" : \"flex-start\",\r\n                                marginBottom: 10\r\n                            }}\r\n                        >\r\n                            <div\r\n                                style={{\r\n                                    ...styles.bubble,\r\n                                    background:\r\n                                        msg.sender === \"user\" ? \"#6c63ff\" : \"#f2f2f2\",\r\n                                    color: msg.sender === \"user\" ? \"#fff\" : \"#000\"\r\n                                }}\r\n                            >\r\n                                {msg.text}\r\n\r\n                                {(msg.fileBlob || msg.fileUrl) && (\r\n                                    <div style={{ marginTop: 10 }}>\r\n                                        <button\r\n                                            style={styles.downloadBtn}\r\n                                            onClick={() => {\r\n                                                if (msg.fileBlob) {\r\n                                                    downloadDocx(msg.fileBlob, \"document.docx\");\r\n                                                } else if (msg.fileUrl) {\r\n                                                    window.open(msg.fileUrl, \"_blank\");\r\n                                                }\r\n                                            }}\r\n                                        >\r\n                                            ‚¨áÔ∏è DescarcƒÉ documentul\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n\r\n                    {isLoading && (\r\n                        <div style={styles.typing}>Bot scrie...</div>\r\n                    )}\r\n\r\n                    <div ref={messagesEndRef} />\r\n                </div>\r\n\r\n                {/* INPUT BAR */}\r\n                <div style={styles.inputBar}>\r\n                    {mode === 'analysis' && (\r\n                        <>\r\n                            <input \r\n                                type=\"file\" \r\n                                ref={fileInputRef}\r\n                                style={{ display: 'none' }}\r\n                                accept=\".pdf\"\r\n                                onChange={handleFileUpload}\r\n                            />\r\n                            <button \r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                style={styles.attachBtn}\r\n                                title=\"√éncarcƒÉ PDF\"\r\n                            >\r\n                                üìé\r\n                            </button>\r\n                        </>\r\n                    )}\r\n                    \r\n                    <input\r\n                        value={input}\r\n                        onChange={e => setInput(e.target.value)}\r\n                        onKeyDown={e => e.key === \"Enter\" && sendMessage()}\r\n                        placeholder={mode === 'analysis' ? \"√éncarcƒÉ un fi»ôier...\" : \"Scrie mesajul...\"}\r\n                        style={styles.input}\r\n                        disabled={isLoading}\r\n                    />\r\n                    <button\r\n                        onClick={sendMessage}\r\n                        style={styles.sendBtn}\r\n                        disabled={isLoading}\r\n                    >\r\n                        Trimite\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <ChatHistorySidebar \r\n                isOpen={isHistoryOpen} \r\n                onClose={() => setIsHistoryOpen(false)} \r\n                conversations={conversations}\r\n                onSelectConversation={handleSelectConversation}\r\n                onNewConversation={handleNewConversation}\r\n                onDeleteConversation={deleteConversation}\r\n                loading={historyLoading}\r\n            />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default ChatUI;\r\n\r\nconst styles = {\r\n    wrapper: {\r\n        height: \"100%\",\r\n        display: \"flex\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\"\r\n    },\r\n\r\n    chatContainer: {\r\n        flex: 1,\r\n        height: \"100%\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        background: \"#fff\",\r\n        position: \"relative\"\r\n    },\r\n\r\n    header: {\r\n        padding: \"12px 24px\",\r\n        display: \"flex\",\r\n        justifyContent: \"space-between\",\r\n        alignItems: \"center\",\r\n        background: \"#fff\", \r\n    },\r\n\r\n    messages: {\r\n        flex: 1,\r\n        padding: 20,\r\n        overflowY: \"auto\"\r\n    },\r\n\r\n    bubble: {\r\n        maxWidth: \"70%\",\r\n        padding: 14,\r\n        borderRadius: 16,\r\n        whiteSpace: \"pre-wrap\"\r\n    },\r\n\r\n    typing: {\r\n        fontSize: 12,\r\n        color: \"#999\",\r\n        marginTop: 6\r\n    },\r\n\r\n    inputBar: {\r\n        display: \"flex\",\r\n        gap: 10,\r\n        padding: 14,\r\n        borderTop: \"1px solid #eee\",\r\n        background: \"#fff\"\r\n    },\r\n\r\n    input: {\r\n        flex: 1,\r\n        padding: 12,\r\n        borderRadius: 10,\r\n        border: \"1px solid #ddd\",\r\n        outline: \"none\"\r\n    },\r\n\r\n    sendBtn: {\r\n        padding: \"0 20px\",\r\n        borderRadius: 10,\r\n        border: \"none\",\r\n        background: \"#6c63ff\",\r\n        color: \"#fff\",\r\n        cursor: \"pointer\"\r\n    },\r\n\r\n    attachBtn: {\r\n        padding: \"0 14px\",\r\n        borderRadius: 10,\r\n        border: \"1px solid #ddd\",\r\n        background: \"#f9fafb\",\r\n        cursor: \"pointer\",\r\n        fontSize: \"18px\"\r\n    },\r\n\r\n    downloadBtn: {\r\n        marginTop: 4,\r\n        padding: \"6px 10px\",\r\n        borderRadius: 6,\r\n        border: \"none\",\r\n        cursor: \"pointer\"\r\n    }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
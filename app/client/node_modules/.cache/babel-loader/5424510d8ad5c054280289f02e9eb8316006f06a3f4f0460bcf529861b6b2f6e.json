{"ast":null,"code":"var _s = $RefreshSig$();\n// src/hooks/useDocumentData.js\n\nimport { useState, useEffect } from 'react';\nimport { collection, getDocs, addDoc } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { db, storage } from '../InitApp/firebase';\nexport const useDocumentData = () => {\n  _s();\n  const [documents, setDocuments] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const loadDocs = async () => {\n      try {\n        const snapshot = await getDocs(collection(db, \"documentModels\"));\n        const list = snapshot.docs.map(doc => ({\n          id: doc.id,\n          ...doc.data()\n        }));\n        setDocuments(list);\n        setLoading(false);\n      } catch (err) {\n        console.error(\"Eroare la încărcare:\", err);\n        setError(\"Nu s-au putut încărca documentele din Firebase.\");\n        setLoading(false);\n      }\n    };\n    loadDocs();\n  }, []);\n  const addNewDocument = async docData => {\n    try {\n      let fileUrl = docData.url || \"\";\n\n      // If a file object is present, upload it to Storage\n      if (docData.file) {\n        const storageRef = ref(storage, `documents/${Date.now()}_${docData.file.name}`);\n        const snapshot = await uploadBytes(storageRef, docData.file);\n        fileUrl = await getDownloadURL(snapshot.ref);\n      }\n\n      // Prepare data for Firestore (exclude the raw file object)\n      const {\n        file,\n        ...firestoreData\n      } = docData;\n      const finalData = {\n        ...firestoreData,\n        url: fileUrl,\n        type: 'pdf' // Enforce type as pdf for uploaded files\n      };\n      const docRef = await addDoc(collection(db, \"documentModels\"), finalData);\n      const newDoc = {\n        id: docRef.id,\n        ...finalData\n      };\n      setDocuments(prevDocs => [...prevDocs, newDoc]);\n      return newDoc;\n    } catch (err) {\n      console.error(\"Eroare la adăugare:\", err);\n      throw err;\n    }\n  };\n  return {\n    documents,\n    loading,\n    error,\n    addNewDocument\n  };\n};\n_s(useDocumentData, \"vPpX9y5GrjLlQ9TCkQ56wUrwt2s=\");","map":{"version":3,"names":["useState","useEffect","collection","getDocs","addDoc","ref","uploadBytes","getDownloadURL","db","storage","useDocumentData","_s","documents","setDocuments","loading","setLoading","error","setError","loadDocs","snapshot","list","docs","map","doc","id","data","err","console","addNewDocument","docData","fileUrl","url","file","storageRef","Date","now","name","firestoreData","finalData","type","docRef","newDoc","prevDocs"],"sources":["C:/Users/40741/IdeaProjects/lawsome-app/src/hooks/useDocumentData.js"],"sourcesContent":["// src/hooks/useDocumentData.js\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { collection, getDocs, addDoc } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { db, storage } from '../InitApp/firebase';\r\n\r\nexport const useDocumentData = () => {\r\n    const [documents, setDocuments] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    useEffect(() => {\r\n        const loadDocs = async () => {\r\n            try {\r\n                const snapshot = await getDocs(collection(db, \"documentModels\"));\r\n                const list = snapshot.docs.map(doc => ({\r\n                    id: doc.id,\r\n                    ...doc.data()\r\n                }));\r\n\r\n                setDocuments(list);\r\n                setLoading(false);\r\n            } catch (err) {\r\n                console.error(\"Eroare la încărcare:\", err);\r\n                setError(\"Nu s-au putut încărca documentele din Firebase.\");\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        loadDocs();\r\n    }, []);\r\n\r\n    const addNewDocument = async (docData) => {\r\n        try {\r\n            let fileUrl = docData.url || \"\";\r\n\r\n            // If a file object is present, upload it to Storage\r\n            if (docData.file) {\r\n                const storageRef = ref(storage, `documents/${Date.now()}_${docData.file.name}`);\r\n                const snapshot = await uploadBytes(storageRef, docData.file);\r\n                fileUrl = await getDownloadURL(snapshot.ref);\r\n            }\r\n\r\n            // Prepare data for Firestore (exclude the raw file object)\r\n            const { file, ...firestoreData } = docData;\r\n            const finalData = {\r\n                ...firestoreData,\r\n                url: fileUrl,\r\n                type: 'pdf' // Enforce type as pdf for uploaded files\r\n            };\r\n\r\n            const docRef = await addDoc(collection(db, \"documentModels\"), finalData);\r\n            const newDoc = { id: docRef.id, ...finalData };\r\n            \r\n            setDocuments(prevDocs => [...prevDocs, newDoc]);\r\n            return newDoc;\r\n        } catch (err) {\r\n            console.error(\"Eroare la adăugare:\", err);\r\n            throw err;\r\n        }\r\n    };\r\n\r\n    return { documents, loading, error, addNewDocument };\r\n};\r\n"],"mappings":";AAAA;;AAEA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SAASC,UAAU,EAAEC,OAAO,EAAEC,MAAM,QAAQ,oBAAoB;AAChE,SAASC,GAAG,EAAEC,WAAW,EAAEC,cAAc,QAAQ,kBAAkB;AACnE,SAASC,EAAE,EAAEC,OAAO,QAAQ,qBAAqB;AAEjD,OAAO,MAAMC,eAAe,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACjC,MAAM,CAACC,SAAS,EAAEC,YAAY,CAAC,GAAGb,QAAQ,CAAC,EAAE,CAAC;EAC9C,MAAM,CAACc,OAAO,EAAEC,UAAU,CAAC,GAAGf,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACgB,KAAK,EAAEC,QAAQ,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAExCC,SAAS,CAAC,MAAM;IACZ,MAAMiB,QAAQ,GAAG,MAAAA,CAAA,KAAY;MACzB,IAAI;QACA,MAAMC,QAAQ,GAAG,MAAMhB,OAAO,CAACD,UAAU,CAACM,EAAE,EAAE,gBAAgB,CAAC,CAAC;QAChE,MAAMY,IAAI,GAAGD,QAAQ,CAACE,IAAI,CAACC,GAAG,CAACC,GAAG,KAAK;UACnCC,EAAE,EAAED,GAAG,CAACC,EAAE;UACV,GAAGD,GAAG,CAACE,IAAI,CAAC;QAChB,CAAC,CAAC,CAAC;QAEHZ,YAAY,CAACO,IAAI,CAAC;QAClBL,UAAU,CAAC,KAAK,CAAC;MACrB,CAAC,CAAC,OAAOW,GAAG,EAAE;QACVC,OAAO,CAACX,KAAK,CAAC,sBAAsB,EAAEU,GAAG,CAAC;QAC1CT,QAAQ,CAAC,iDAAiD,CAAC;QAC3DF,UAAU,CAAC,KAAK,CAAC;MACrB;IACJ,CAAC;IAEDG,QAAQ,CAAC,CAAC;EACd,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMU,cAAc,GAAG,MAAOC,OAAO,IAAK;IACtC,IAAI;MACA,IAAIC,OAAO,GAAGD,OAAO,CAACE,GAAG,IAAI,EAAE;;MAE/B;MACA,IAAIF,OAAO,CAACG,IAAI,EAAE;QACd,MAAMC,UAAU,GAAG5B,GAAG,CAACI,OAAO,EAAE,aAAayB,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIN,OAAO,CAACG,IAAI,CAACI,IAAI,EAAE,CAAC;QAC/E,MAAMjB,QAAQ,GAAG,MAAMb,WAAW,CAAC2B,UAAU,EAAEJ,OAAO,CAACG,IAAI,CAAC;QAC5DF,OAAO,GAAG,MAAMvB,cAAc,CAACY,QAAQ,CAACd,GAAG,CAAC;MAChD;;MAEA;MACA,MAAM;QAAE2B,IAAI;QAAE,GAAGK;MAAc,CAAC,GAAGR,OAAO;MAC1C,MAAMS,SAAS,GAAG;QACd,GAAGD,aAAa;QAChBN,GAAG,EAAED,OAAO;QACZS,IAAI,EAAE,KAAK,CAAC;MAChB,CAAC;MAED,MAAMC,MAAM,GAAG,MAAMpC,MAAM,CAACF,UAAU,CAACM,EAAE,EAAE,gBAAgB,CAAC,EAAE8B,SAAS,CAAC;MACxE,MAAMG,MAAM,GAAG;QAAEjB,EAAE,EAAEgB,MAAM,CAAChB,EAAE;QAAE,GAAGc;MAAU,CAAC;MAE9CzB,YAAY,CAAC6B,QAAQ,IAAI,CAAC,GAAGA,QAAQ,EAAED,MAAM,CAAC,CAAC;MAC/C,OAAOA,MAAM;IACjB,CAAC,CAAC,OAAOf,GAAG,EAAE;MACVC,OAAO,CAACX,KAAK,CAAC,qBAAqB,EAAEU,GAAG,CAAC;MACzC,MAAMA,GAAG;IACb;EACJ,CAAC;EAED,OAAO;IAAEd,SAAS;IAAEE,OAAO;IAAEE,KAAK;IAAEY;EAAe,CAAC;AACxD,CAAC;AAACjB,EAAA,CAzDWD,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { db, storage } from '../InitApp/firebase';\nimport { collection, query, where, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\nexport const useChatHistory = userId => {\n  _s();\n  const [history, setHistory] = useState([]);\n  const [loading, setLoading] = useState(true);\n  useEffect(() => {\n    if (!userId) {\n      setHistory([]);\n      setLoading(false);\n      return;\n    }\n    const q = query(collection(db, 'chat_history'), where('userId', '==', userId), orderBy('timestamp', 'asc'));\n    const unsubscribe = onSnapshot(q, snapshot => {\n      const msgs = snapshot.docs.map(doc => ({\n        id: doc.id,\n        ...doc.data()\n      }));\n      setHistory(msgs);\n      setLoading(false);\n    });\n    return () => unsubscribe();\n  }, [userId]);\n  const saveMessage = async message => {\n    if (!userId) return;\n    let fileUrl = null;\n    if (message.fileBlob) {\n      try {\n        const storageRef = ref(storage, `chat_files/${userId}/${Date.now()}_document.docx`);\n        await uploadBytes(storageRef, message.fileBlob);\n        fileUrl = await getDownloadURL(storageRef);\n      } catch (error) {\n        console.error(\"Error uploading file:\", error);\n      }\n    }\n    await addDoc(collection(db, 'chat_history'), {\n      userId,\n      text: message.text,\n      sender: message.sender,\n      timestamp: serverTimestamp(),\n      fileUrl: fileUrl || null\n    });\n  };\n  return {\n    history,\n    loading,\n    saveMessage\n  };\n};\n_s(useChatHistory, \"Ieukcr00HhsUBPlfQ8IG0OBl+dQ=\");","map":{"version":3,"names":["useState","useEffect","db","storage","collection","query","where","orderBy","onSnapshot","addDoc","serverTimestamp","ref","uploadBytes","getDownloadURL","useChatHistory","userId","_s","history","setHistory","loading","setLoading","q","unsubscribe","snapshot","msgs","docs","map","doc","id","data","saveMessage","message","fileUrl","fileBlob","storageRef","Date","now","error","console","text","sender","timestamp"],"sources":["C:/Users/40741/IdeaProjects/lawsome-app/src/hooks/useChatHistory.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { db, storage } from '../InitApp/firebase';\r\nimport { collection, query, where, orderBy, onSnapshot, addDoc, serverTimestamp } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\n\r\nexport const useChatHistory = (userId) => {\r\n    const [history, setHistory] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!userId) {\r\n            setHistory([]);\r\n            setLoading(false);\r\n            return;\r\n        }\r\n\r\n        const q = query(\r\n            collection(db, 'chat_history'),\r\n            where('userId', '==', userId),\r\n            orderBy('timestamp', 'asc')\r\n        );\r\n\r\n        const unsubscribe = onSnapshot(q, (snapshot) => {\r\n            const msgs = snapshot.docs.map(doc => ({\r\n                id: doc.id,\r\n                ...doc.data()\r\n            }));\r\n            setHistory(msgs);\r\n            setLoading(false);\r\n        });\r\n\r\n        return () => unsubscribe();\r\n    }, [userId]);\r\n\r\n    const saveMessage = async (message) => {\r\n        if (!userId) return;\r\n\r\n        let fileUrl = null;\r\n        if (message.fileBlob) {\r\n            try {\r\n                const storageRef = ref(storage, `chat_files/${userId}/${Date.now()}_document.docx`);\r\n                await uploadBytes(storageRef, message.fileBlob);\r\n                fileUrl = await getDownloadURL(storageRef);\r\n            } catch (error) {\r\n                console.error(\"Error uploading file:\", error);\r\n            }\r\n        }\r\n\r\n        await addDoc(collection(db, 'chat_history'), {\r\n            userId,\r\n            text: message.text,\r\n            sender: message.sender,\r\n            timestamp: serverTimestamp(),\r\n            fileUrl: fileUrl || null\r\n        });\r\n    };\r\n\r\n    return { history, loading, saveMessage };\r\n};\r\n"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SAASC,EAAE,EAAEC,OAAO,QAAQ,qBAAqB;AACjD,SAASC,UAAU,EAAEC,KAAK,EAAEC,KAAK,EAAEC,OAAO,EAAEC,UAAU,EAAEC,MAAM,EAAEC,eAAe,QAAQ,oBAAoB;AAC3G,SAASC,GAAG,EAAEC,WAAW,EAAEC,cAAc,QAAQ,kBAAkB;AAEnE,OAAO,MAAMC,cAAc,GAAIC,MAAM,IAAK;EAAAC,EAAA;EACtC,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGlB,QAAQ,CAAC,EAAE,CAAC;EAC1C,MAAM,CAACmB,OAAO,EAAEC,UAAU,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EAE5CC,SAAS,CAAC,MAAM;IACZ,IAAI,CAACc,MAAM,EAAE;MACTG,UAAU,CAAC,EAAE,CAAC;MACdE,UAAU,CAAC,KAAK,CAAC;MACjB;IACJ;IAEA,MAAMC,CAAC,GAAGhB,KAAK,CACXD,UAAU,CAACF,EAAE,EAAE,cAAc,CAAC,EAC9BI,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAES,MAAM,CAAC,EAC7BR,OAAO,CAAC,WAAW,EAAE,KAAK,CAC9B,CAAC;IAED,MAAMe,WAAW,GAAGd,UAAU,CAACa,CAAC,EAAGE,QAAQ,IAAK;MAC5C,MAAMC,IAAI,GAAGD,QAAQ,CAACE,IAAI,CAACC,GAAG,CAACC,GAAG,KAAK;QACnCC,EAAE,EAAED,GAAG,CAACC,EAAE;QACV,GAAGD,GAAG,CAACE,IAAI,CAAC;MAChB,CAAC,CAAC,CAAC;MACHX,UAAU,CAACM,IAAI,CAAC;MAChBJ,UAAU,CAAC,KAAK,CAAC;IACrB,CAAC,CAAC;IAEF,OAAO,MAAME,WAAW,CAAC,CAAC;EAC9B,CAAC,EAAE,CAACP,MAAM,CAAC,CAAC;EAEZ,MAAMe,WAAW,GAAG,MAAOC,OAAO,IAAK;IACnC,IAAI,CAAChB,MAAM,EAAE;IAEb,IAAIiB,OAAO,GAAG,IAAI;IAClB,IAAID,OAAO,CAACE,QAAQ,EAAE;MAClB,IAAI;QACA,MAAMC,UAAU,GAAGvB,GAAG,CAACR,OAAO,EAAE,cAAcY,MAAM,IAAIoB,IAAI,CAACC,GAAG,CAAC,CAAC,gBAAgB,CAAC;QACnF,MAAMxB,WAAW,CAACsB,UAAU,EAAEH,OAAO,CAACE,QAAQ,CAAC;QAC/CD,OAAO,GAAG,MAAMnB,cAAc,CAACqB,UAAU,CAAC;MAC9C,CAAC,CAAC,OAAOG,KAAK,EAAE;QACZC,OAAO,CAACD,KAAK,CAAC,uBAAuB,EAAEA,KAAK,CAAC;MACjD;IACJ;IAEA,MAAM5B,MAAM,CAACL,UAAU,CAACF,EAAE,EAAE,cAAc,CAAC,EAAE;MACzCa,MAAM;MACNwB,IAAI,EAAER,OAAO,CAACQ,IAAI;MAClBC,MAAM,EAAET,OAAO,CAACS,MAAM;MACtBC,SAAS,EAAE/B,eAAe,CAAC,CAAC;MAC5BsB,OAAO,EAAEA,OAAO,IAAI;IACxB,CAAC,CAAC;EACN,CAAC;EAED,OAAO;IAAEf,OAAO;IAAEE,OAAO;IAAEW;EAAY,CAAC;AAC5C,CAAC;AAACd,EAAA,CArDWF,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}